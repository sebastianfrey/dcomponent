<html>
  <head>
    <link rel="stylesheet" href="./lib/dojo/resources/dojo.css" />    
    <link rel="stylesheet" href="./lib/dijit/themes/claro/claro.css" />
    <link rel="stylesheet" href="./lib/dcomponent/resources/dcomponent.css" />    
  </head>
  <body class="claro">
    <script src="./dojoConfig.js"></script>
    <script src="./lib/dojo/dojo.js"></script>
    <script>
      require([
        'dcomponent/SimpleComponent',
        'dcomponent/Factory',
        'dojo/_base/declare',
        'dstore/Memory',
        'dstore/Trackable',
        'dijit/form/Button',
        'dojo/text!./StoreData.json',
        'dojo/domReady!'
      ], function(SimpleComponent, Factory, declare, Memory, Trackable, Button, StoreData) {
        
        var TrackableMemory = declare([Memory, Trackable]);
        var idCounter = 0;
        
        var factory = new Factory({
          registry: {
            numberspinner: 'dijit/form/NumberSpinner',
            textarea: 'dijit/form/Textarea',
            textbox: 'dijit/form/TextBox',
            checkbox: 'dijit/form/CheckBox'
          }
        });
        
        var data = JSON.parse(StoreData).data.map(function(item) {
          item.id = idCounter++;
          return item
        });
        
        var secondData = JSON.parse(JSON.stringify(JSON.parse(StoreData))).data.map(function(item) {
          item.id = idCounter++;
          return item
        }).reverse();
        
        var store = new TrackableMemory({ data: data });
        var secondStore = new TrackableMemory({ data: secondData });
        
        var comp = new SimpleComponent({
          store: store,
          factory: factory
        }, 'componentNode');
        comp.startup();
        
        new Button({
          label: 'update',
          onClick: function() {
            store.put({
              id: 3,
              type: 'numberspinner',
              label: 'Numberspinner',
              properties: {
                value: 500,
                smallDelta: 10,
                constraints: { min:9, max:1550, places:0 }
              }
            });
          }
        }, 'updateButtonNode').startup();
        
        new Button({
          label: 'add',
          onClick: function() {
            store.add({
              id: idCounter++,
              type: 'textarea',
              label: 'Beschreibung',
              properties: {
                value: 'Huhu,\nWie geht es dir?'
              }
            });
          }
        }, 'addButtonNode').startup();
        
        new Button({
          label: 'change to second store',
          onClick: function() {
            comp.set('store', secondStore);
          }
        }, 'changeStoreButtonNode').startup(); 
        
        new Button({
          label: 'change to first store',
          onClick: function() {
            comp.set('store', store);
          }
        }, 'changeStore2ButtonNode').startup();    
      });
    </script>
    <div id="componentNode"></div>
    <div id="updateButtonNode"></div>
    <div id="addButtonNode"></div>
    <div id="changeStoreButtonNode"></div>
    <div id="changeStore2ButtonNode"></div>
  </body>
</html>